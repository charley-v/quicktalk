import { existsSync as _existsSync } from 'fs';
import _fsp from 'fs/promises';
import { execa as _execa } from 'execa';
import * as _path from 'path';
import { LogLevel } from '../printer/printer.js';
import { printer } from '../printer.js';
import { executeWithDebugLogger as _executeWithDebugLogger } from './execute_with_debugger_logger.js';
import { getPackageManagerRunnerName } from './get_package_manager_name.js';
/**
 * PackageManagerController is an abstraction around package manager commands that are needed to initialize a project and install dependencies
 */
export class PackageManagerControllerBase {
    cwd;
    executable;
    initDefault;
    installCommand;
    fsp;
    path;
    execa;
    executeWithDebugLogger;
    existsSync;
    binaryRunner;
    /**
     * constructor - sets the project root
     */
    constructor(cwd, executable, initDefault, installCommand, fsp = _fsp, path = _path, execa = _execa, executeWithDebugLogger = _executeWithDebugLogger, existsSync = _existsSync) {
        this.cwd = cwd;
        this.executable = executable;
        this.initDefault = initDefault;
        this.installCommand = installCommand;
        this.fsp = fsp;
        this.path = path;
        this.execa = execa;
        this.executeWithDebugLogger = executeWithDebugLogger;
        this.existsSync = existsSync;
        this.binaryRunner = getPackageManagerRunnerName();
    }
    /**
     * installDependencies - installs dependencies in the project root
     */
    async installDependencies(packageNames, type) {
        const args = [`${this.installCommand}`].concat(...packageNames);
        if (type === 'dev') {
            args.push('-D');
        }
        await this.executeWithDebugLogger(this.cwd, this.executable, args, this.execa);
    }
    /**
     * initializeProject - initializes a project in the project root by checking the package.json file
     */
    initializeProject = async () => {
        if (this.packageJsonExists(this.cwd)) {
            // if package.json already exists, no need to do anything
            return;
        }
        printer.log(`No package.json file found in the current directory. Running \`${this.executable} init\`...`, LogLevel.DEBUG);
        try {
            await this.executeWithDebugLogger(this.cwd, this.executable, this.initDefault, this.execa);
        }
        catch {
            throw new Error(`\`${this.executable} init\` did not exit successfully. Initialize a valid JavaScript package before continuing.`);
        }
        if (!this.packageJsonExists(this.cwd)) {
            // this should only happen if the customer exits out of npm init before finishing
            throw new Error(`package.json does not exist after running \`${this.executable} init\`. Initialize a valid JavaScript package before continuing.'`);
        }
    };
    /**
     * initializeTsConfig - initializes a tsconfig.json file in the project root
     *
     * When changing this method, double check if a corresponding change is needed in the integration test setup in `setup_dir_as_esm_module.ts`.
     */
    async initializeTsConfig(targetDir) {
        const tsConfigTemplate = {
            compilerOptions: {
                target: 'es2022',
                module: 'es2022',
                moduleResolution: 'bundler',
                resolveJsonModule: true,
                esModuleInterop: true,
                forceConsistentCasingInFileNames: true,
                strict: true,
                skipLibCheck: true,
                // The path here is coupled with backend-function's generated typedef file path
                paths: { '$amplify/*': ['../.amplify/generated/*'] },
            },
        };
        const tsConfigPath = this.path.resolve(targetDir, 'tsconfig.json');
        await this.fsp.writeFile(tsConfigPath, JSON.stringify(tsConfigTemplate, null, 2), 'utf-8');
    }
    /**
     * runWithPackageManager - Factory function that runs a command with the specified package manager's binary runner
     */
    runWithPackageManager(args = [], dir, options) {
        return this.executeWithDebugLogger(dir, this.binaryRunner, args, this.execa, options);
    }
    getCommand = (args) => `${this.binaryRunner} ${args.join(' ')}`;
    /**
     * allowsSignalPropagation - Determines if the package manager allows the process
     * signals such as SIGINT to be propagated to the underlying node process.
     * @deprecated
     */
    allowsSignalPropagation = () => true;
    /**
     * Check if a package.json file exists in projectRoot
     */
    packageJsonExists = (projectRoot) => {
        return this.existsSync(this.path.resolve(projectRoot, 'package.json'));
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFja2FnZV9tYW5hZ2VyX2NvbnRyb2xsZXJfYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wYWNrYWdlLW1hbmFnZXItY29udHJvbGxlci9wYWNrYWdlX21hbmFnZXJfY29udHJvbGxlcl9iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLElBQUksV0FBVyxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBQy9DLE9BQU8sSUFBSSxNQUFNLGFBQWEsQ0FBQztBQUMvQixPQUFPLEVBQXdDLEtBQUssSUFBSSxNQUFNLEVBQUUsTUFBTSxPQUFPLENBQUM7QUFDOUUsT0FBTyxLQUFLLEtBQUssTUFBTSxNQUFNLENBQUM7QUFFOUIsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ2pELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeEMsT0FBTyxFQUFFLHNCQUFzQixJQUFJLHVCQUF1QixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDdEcsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFFNUU7O0dBRUc7QUFDSCxNQUFNLE9BQWdCLDRCQUE0QjtJQVEzQjtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFiRixZQUFZLENBQVM7SUFDeEM7O09BRUc7SUFDSCxZQUNxQixHQUFXLEVBQ1gsVUFBa0IsRUFDbEIsV0FBcUIsRUFDckIsY0FBc0IsRUFDdEIsTUFBTSxJQUFJLEVBQ1YsT0FBTyxLQUFLLEVBQ1osUUFBUSxNQUFNLEVBQ2QseUJBQXlCLHVCQUF1QixFQUNoRCxhQUFhLFdBQVc7UUFSeEIsUUFBRyxHQUFILEdBQUcsQ0FBUTtRQUNYLGVBQVUsR0FBVixVQUFVLENBQVE7UUFDbEIsZ0JBQVcsR0FBWCxXQUFXLENBQVU7UUFDckIsbUJBQWMsR0FBZCxjQUFjLENBQVE7UUFDdEIsUUFBRyxHQUFILEdB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Q0FBQyxLQUFLLEVBQ1YsT0FBTyxDQUNSLENBQUM7SUFDSixDQUFDO0lBRUQsVUFBVSxHQUFHLENBQUMsSUFBYyxFQUFFLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO0lBRTFFOzs7O09BSUc7SUFDSCx1QkFBdUIsR0FBRyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUM7SUFFckM7O09BRUc7SUFDSyxpQkFBaUIsR0FBRyxDQUFDLFdBQW1CLEVBQVcsRUFBRTtRQUMzRCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLGNBQWMsQ0FBQyxDQUFDLENBQUM7SUFDekUsQ0FBQyxDQUFDO0NBQ0giLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBleGlzdHNTeW5jIGFzIF9leGlzdHNTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IF9mc3AgZnJvbSAnZnMvcHJvbWlzZXMnO1xuaW1wb3J0IHsgdHlwZSBFeGVjYUNoaWxkUHJvY2VzcywgdHlwZSBPcHRpb25zLCBleGVjYSBhcyBfZXhlY2EgfSBmcm9tICdleGVjYSc7XG5pbXBvcnQgKiBhcyBfcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IHR5cGUgUGFja2FnZU1hbmFnZXJDb250cm9sbGVyIH0gZnJvbSAnQGF3cy1hbXBsaWZ5L3BsdWdpbi10eXBlcyc7XG5pbXBvcnQgeyBMb2dMZXZlbCB9IGZyb20gJy4uL3ByaW50ZXIvcHJpbnRlci5qcyc7XG5pbXBvcnQgeyBwcmludGVyIH0gZnJvbSAnLi4vcHJpbnRlci5qcyc7XG5pbXBvcnQgeyBleGVjdXRlV2l0aERlYnVnTG9nZ2VyIGFzIF9leGVjdXRlV2l0aERlYnVnTG9nZ2VyIH0gZnJvbSAnLi9leGVjdXRlX3dpdGhfZGVidWdnZXJfbG9nZ2VyLmpzJztcbmltcG9ydCB7IGdldFBhY2thZ2VNYW5hZ2VyUnVubmVyTmFtZSB9IGZyb20gJy4vZ2V0X3BhY2thZ2VfbWFuYWdlcl9uYW1lLmpzJztcblxuLyoqXG4gKiBQYWNrYWdlTWFuYWdlckNvbnRyb2xsZXIgaXMgYW4gYWJzdHJhY3Rpb24gYXJvdW5kIHBhY2thZ2UgbWFuYWdlciBjb21tYW5kcyB0aGF0IGFyZSBuZWVkZWQgdG8gaW5pdGlhbGl6ZSBhIHByb2plY3QgYW5kIGluc3RhbGwgZGVwZW5kZW5jaWVzXG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBQYWNrYWdlTWFuYWdlckNvbnRyb2xsZXJCYXNlXG4gIGltcGxlbWVudHMgUGFja2FnZU1hbmFnZXJDb250cm9sbGVyXG57XG4gIHByb3RlY3RlZCByZWFkb25seSBiaW5hcnlSdW5uZXI6IHN0cmluZztcbiAgLyoqXG4gICAqIGNvbnN0cnVjdG9yIC0gc2V0cyB0aGUgcHJvamVjdCByb290XG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgY3dkOiBzdHJpbmcsXG4gICAgcHJvdGVjdGVkIHJlYWRvbmx5IGV4ZWN1dGFibGU6IHN0cmluZyxcbiAgICBwcm90ZWN0ZWQgcmVhZG9ubHkgaW5pdERlZmF1bHQ6IHN0cmluZ1tdLFxuICAgIHByb3RlY3RlZCByZWFkb25seSBpbnN0YWxsQ29tbWFuZDogc3RyaW5nLFxuICAgIHByb3RlY3RlZCByZWFkb25seSBmc3AgPSBfZnNwLFxuICAgIHByb3RlY3RlZCByZWFkb25seSBwYXRoID0gX3BhdGgsXG4gICAgcHJvdGVjdGVkIHJlYWRvbmx5IGV4ZWNhID0gX2V4ZWNhLFxuICAgIHByb3RlY3RlZCByZWFkb25seSBleGVjdXRlV2l0aERlYnVnTG9nZ2VyID0gX2V4ZWN1dGVXaXRoRGVidWdMb2dnZXIsXG4gICAgcHJvdGVjdGVkIHJlYWRvbmx5IGV4aXN0c1N5bmMgPSBfZXhpc3RzU3luY1xuICApIHtcbiAgICB0aGlzLmJpbmFyeVJ1bm5lciA9IGdldFBhY2thZ2VNYW5hZ2VyUnVubmVyTmFtZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIGluc3RhbGxEZXBlbmRlbmNpZXMgLSBpbnN0YWxscyBkZXBlbmRlbmNpZXMgaW4gdGhlIHByb2plY3Qgcm9vdFxuICAgKi9cbiAgYXN5bmMgaW5zdGFsbERlcGVuZGVuY2llcyhcbiAgICBwYWNrYWdlTmFtZXM6IHN0cmluZ1tdLFxuICAgIHR5cGU6ICdkZXYnIHwgJ3Byb2QnXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGFyZ3MgPSBbYCR7dGhpcy5pbnN0YWxsQ29tbWFuZH1gXS5jb25jYXQoLi4ucGFja2FnZU5hbWVzKTtcbiAgICBpZiAodHlwZSA9PT0gJ2RldicpIHtcbiAgICAgIGFyZ3MucHVzaCgnLUQnKTtcbiAgICB9XG5cbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVXaXRoRGVidWdMb2dnZXIoXG4gICAgICB0aGlzLmN3ZCxcbiAgICAgIHRoaXMuZXhlY3V0YWJsZSxcbiAgICAgIGFyZ3MsXG4gICAgICB0aGlzLmV4ZWNhXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBpbml0aWFsaXplUHJvamVjdCAtIGluaXRpYWxpemVzIGEgcHJvamVjdCBpbiB0aGUgcHJvamVjdCByb290IGJ5IGNoZWNraW5nIHRoZSBwYWNrYWdlLmpzb24gZmlsZVxuICAgKi9cbiAgaW5pdGlhbGl6ZVByb2plY3QgPSBhc3luYyAoKSA9PiB7XG4gICAgaWYgKHRoaXMucGFja2FnZUpzb25FeGlzdHModGhpcy5jd2QpKSB7XG4gICAgICAvLyBpZiBwYWNrYWdlLmpzb24gYWxyZWFkeSBleGlzdHMsIG5vIG5lZWQgdG8gZG8gYW55dGhpbmdcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBwcmludGVyLmxvZyhcbiAgICAgIGBObyBwYWNrYWdlLmpzb24gZmlsZSBmb3VuZCBpbiB0aGUgY3VycmVudCBkaXJlY3RvcnkuIFJ1bm5pbmcgXFxgJHt0aGlzLmV4ZWN1dGFibGV9IGluaXRcXGAuLi5gLFxuICAgICAgTG9nTGV2ZWwuREVCVUdcbiAgICApO1xuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuZXhlY3V0ZVdpdGhEZWJ1Z0xvZ2dlcihcbiAgICAgICAgdGhpcy5jd2QsXG4gICAgICAgIHRoaXMuZXhlY3V0YWJsZSxcbiAgICAgICAgdGhpcy5pbml0RGVmYXVsdCxcbiAgICAgICAgdGhpcy5leGVjYVxuICAgICAgKTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYFxcYCR7dGhpcy5leGVjdXRhYmxlfSBpbml0XFxgIGRpZCBub3QgZXhpdCBzdWNjZXNzZnVsbHkuIEluaXRpYWxpemUgYSB2YWxpZCBKYXZhU2NyaXB0IHBhY2thZ2UgYmVmb3JlIGNvbnRpbnVpbmcuYFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMucGFja2FnZUpzb25FeGlzdHModGhpcy5jd2QpKSB7XG4gICAgICAvLyB0aGlzIHNob3VsZCBvbmx5IGhhcHBlbiBpZiB0aGUgY3VzdG9tZXIgZXhpdHMgb3V0IG9mIG5wbSBpbml0IGJlZm9yZSBmaW5pc2hpbmdcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYHBhY2thZ2UuanNvbiBkb2VzIG5vdCBleGlzdCBhZnRlciBydW5uaW5nIFxcYCR7dGhpcy5leGVjdXRhYmxlfSBpbml0XFxgLiBJbml0aWFsaXplIGEgdmFsaWQgSmF2YVNjcmlwdCBwYWNrYWdlIGJlZm9yZSBjb250aW51aW5nLidgXG4gICAgICApO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogaW5pdGlhbGl6ZVRzQ29uZmlnIC0gaW5pdGlhbGl6ZXMgYSB0c2NvbmZpZy5qc29uIGZpbGUgaW4gdGhlIHByb2plY3Qgcm9vdFxuICAgKlxuICAgKiBXaGVuIGNoYW5naW5nIHRoaXMgbWV0aG9kLCBkb3VibGUgY2hlY2sgaWYgYSBjb3JyZXNwb25kaW5nIGNoYW5nZSBpcyBuZWVkZWQgaW4gdGhlIGludGVncmF0aW9uIHRlc3Qgc2V0dXAgaW4gYHNldHVwX2Rpcl9hc19lc21fbW9kdWxlLnRzYC5cbiAgICovXG4gIGFzeW5jIGluaXRpYWxpemVUc0NvbmZpZyh0YXJnZXREaXI6IHN0cmluZykge1xuICAgIGNvbnN0IHRzQ29uZmlnVGVtcGxhdGUgPSB7XG4gICAgICBjb21waWxlck9wdGlvbnM6IHtcbiAgICAgICAgdGFyZ2V0OiAnZXMyMDIyJyxcbiAgICAgICAgbW9kdWxlOiAnZXMyMDIyJyxcbiAgICAgICAgbW9kdWxlUmVzb2x1dGlvbjogJ2J1bmRsZXInLFxuICAgICAgICByZXNvbHZlSnNvbk1vZHVsZTogdHJ1ZSxcbiAgICAgICAgZXNNb2R1bGVJbnRlcm9wOiB0cnVlLFxuICAgICAgICBmb3JjZUNvbnNpc3RlbnRDYXNpbmdJbkZpbGVOYW1lczogdHJ1ZSxcbiAgICAgICAgc3RyaWN0OiB0cnVlLFxuICAgICAgICBza2lwTGliQ2hlY2s6IHRydWUsXG4gICAgICAgIC8vIFRoZSBwYXRoIGhlcmUgaXMgY291cGxlZCB3aXRoIGJhY2tlbmQtZnVuY3Rpb24ncyBnZW5lcmF0ZWQgdHlwZWRlZiBmaWxlIHBhdGhcbiAgICAgICAgcGF0aHM6IHsgJyRhbXBsaWZ5LyonOiBbJy4uLy5hbXBsaWZ5L2dlbmVyYXRlZC8qJ10gfSxcbiAgICAgIH0sXG4gICAgfTtcbiAgICBjb25zdCB0c0NvbmZpZ1BhdGggPSB0aGlzLnBhdGgucmVzb2x2ZSh0YXJnZXREaXIsICd0c2NvbmZpZy5qc29uJyk7XG4gICAgYXdhaXQgdGhpcy5mc3Aud3JpdGVGaWxlKFxuICAgICAgdHNDb25maWdQYXRoLFxuICAgICAgSlNPTi5zdHJpbmdpZnkodHNDb25maWdUZW1wbGF0ZSwgbnVsbCwgMiksXG4gICAgICAndXRmLTgnXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBydW5XaXRoUGFja2FnZU1hbmFnZXIgLSBGYWN0b3J5IGZ1bmN0aW9uIHRoYXQgcnVucyBhIGNvbW1hbmQgd2l0aCB0aGUgc3BlY2lmaWVkIHBhY2thZ2UgbWFuYWdlcidzIGJpbmFyeSBydW5uZXJcbiAgICovXG4gIHJ1bldpdGhQYWNrYWdlTWFuYWdlcihcbiAgICBhcmdzOiBzdHJpbmdbXSA9IFtdLFxuICAgIGRpcjogc3RyaW5nLFxuICAgIG9wdGlvbnM/OiBPcHRpb25zPCd1dGY4Jz5cbiAgKTogRXhlY2FDaGlsZFByb2Nlc3Mge1xuICAgIHJldHVybiB0aGlzLmV4ZWN1dGVXaXRoRGVidWdMb2dnZXIoXG4gICAgICBkaXIsXG4gICAgICB0aGlzLmJpbmFyeVJ1bm5lcixcbiAgICAgIGFyZ3MsXG4gICAgICB0aGlzLmV4ZWNhLFxuICAgICAgb3B0aW9uc1xuICAgICk7XG4gIH1cblxuICBnZXRDb21tYW5kID0gKGFyZ3M6IHN0cmluZ1tdKSA9PiBgJHt0aGlzLmJpbmFyeVJ1bm5lcn0gJHthcmdzLmpvaW4oJyAnKX1gO1xuXG4gIC8qKlxuICAgKiBhbGxvd3NTaWduYWxQcm9wYWdhdGlvbiAtIERldGVybWluZXMgaWYgdGhlIHBhY2thZ2UgbWFuYWdlciBhbGxvd3MgdGhlIHByb2Nlc3NcbiAgICogc2lnbmFscyBzdWNoIGFzIFNJR0lOVCB0byBiZSBwcm9wYWdhdGVkIHRvIHRoZSB1bmRlcmx5aW5nIG5vZGUgcHJvY2Vzcy5cbiAgICogQGRlcHJlY2F0ZWRcbiAgICovXG4gIGFsbG93c1NpZ25hbFByb3BhZ2F0aW9uID0gKCkgPT4gdHJ1ZTtcblxuICAvKipcbiAgICogQ2hlY2sgaWYgYSBwYWNrYWdlLmpzb24gZmlsZSBleGlzdHMgaW4gcHJvamVjdFJvb3RcbiAgICovXG4gIHByaXZhdGUgcGFja2FnZUpzb25FeGlzdHMgPSAocHJvamVjdFJvb3Q6IHN0cmluZyk6IGJvb2xlYW4gPT4ge1xuICAgIHJldHVybiB0aGlzLmV4aXN0c1N5bmModGhpcy5wYXRoLnJlc29sdmUocHJvamVjdFJvb3QsICdwYWNrYWdlLmpzb24nKSk7XG4gIH07XG59XG4iXX0=